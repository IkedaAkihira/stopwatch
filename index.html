<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8"/>
        <title>timer</title>
        <script>
            let timer=NaN,timerState,startButton,count,display,startDate;
            onload=()=>{
                startButton=document.getElementById("start");
                display=document.getElementById("display");
                timerState=(parseInt(localStorage.getItem("timerState")))?1:0;
                startDate=parseInt(localStorage.getItem("startDate"));
                count=(timerState)?(Date.now()-startDate)/10:count;
                console.log(count);
                if(!count)
                    count=0;
                let tmp=count/100;
                display.textContent=`${Math.floor(tmp/3600)}時間${Math.floor((tmp%3600)/60)}分${Math.floor(tmp%60)}秒`;
                if(timerState){
                    startButton.textContent="stop";
                    timer=setInterval(tick,10);
                }
            }
            onunload=()=>{
                localStorage.setItem("timerState",timerState);
                localStorage.setItem("startDate",startDate);
                localStorage.setItem("count",count);
            }
            function start(){
                if(timerState){
                    startButton.textContent="start";
                    timerState=0;
                    clearInterval(timer);
                }else{
                    startButton.textContent="stop";
                    timerState=1;
                    //let date=new Date();
                    startDate=Date.now();
                    timer=setInterval(tick,10);
                }
            }
            function tick(){
                count++;
                let tmp=count/100;
                display.textContent=`${Math.floor(tmp/3600)}時間${Math.floor((tmp%3600)/60)}分${Math.floor(tmp%60)}秒`;
            }
            function reset(){
                count=0;
                startDate=0;
                if(timerState){
                    startButton.textContent="start";
                    timerState=0;
                    clearInterval(timer);
                }
            }
        </script>
    </head>
    <body>
        <h1 id="display"></h1>
        <button onclick="start()" id="start">start</button>
        <button onclick="reset()">reset</button>
    </body>
</html>
